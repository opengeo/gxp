<!DOCTYPE html>
<html debug="true">
  <head>
    <script src="http://extjs.cachefly.net/ext-3.4.0/adapter/ext/ext-base.js"></script>
    <script src="http://extjs.cachefly.net/ext-3.4.0/ext-all-debug.js"></script>
    <script type="text/javascript" src="../../../../externals/openlayers/lib/OpenLayers.js"></script>
    <script type="text/javascript" src="../../../../externals/geoext/lib/GeoExt.js"></script>

    <script type="text/javascript" src="http://extjs.cachefly.net/ext-3.4.0/examples/ux/treegrid/TreeGridSorter.js"></script>
    <script type="text/javascript" src="http://extjs.cachefly.net/ext-3.4.0/examples/ux/treegrid/TreeGridColumnResizer.js"></script>
    <script type="text/javascript" src="http://extjs.cachefly.net/ext-3.4.0/examples/ux/treegrid/TreeGridNodeUI.js"></script>
    <script type="text/javascript" src="http://extjs.cachefly.net/ext-3.4.0/examples/ux/treegrid/TreeGridLoader.js"></script>
    <script type="text/javascript" src="http://extjs.cachefly.net/ext-3.4.0/examples/ux/treegrid/TreeGridColumns.js"></script>
    <script type="text/javascript" src="http://extjs.cachefly.net/ext-3.4.0/examples/ux/treegrid/TreeGrid.js"></script>

    <script type="text/javascript" src="../../../../src/script/loader.js"></script>

    <script type="text/javascript">

        function createSymbolizers() {
            var symbolizers = [];
            symbolizers.push(new OpenLayers.Symbolizer.Point({
                graphicName: "star",
                pointRadius: 8,
                fillColor: "yellow",
                strokeColor: "red",
                strokeWidth: 1
            }));
            symbolizers.push(new OpenLayers.Symbolizer.Polygon({
                fillColor: "olive",
                fillOpacity: 0.25,
                strokeColor: "#666666",
                strokeWidth: 2,
                strokeDashstyle: "dot"
            }));
            symbolizers.push(new OpenLayers.Symbolizer.Text({
                label: "${name}",
                labelAlign: "cm",
                fontColor: "#FF0000",
                fillColor: "yellow",
                graphicName: "square",
                pointRadius: 10
            }));
            return symbolizers;
        }
       
        function test_SymbolizerLoader(t) {
            t.plan(1);
            
            var instance = new gxp.tree.SymbolizerLoader();
            
            t.ok(instance instanceof gxp.tree.SymbolizerLoader, "Instance created successfully");
            
        }

        function test_load(t) {
            t.plan(19);
            var loader = new gxp.tree.SymbolizerLoader({symbolType: "Polygon", symbolizers: createSymbolizers()});
            var root = new Ext.tree.TreeNode();
            var log = [];
            loader.load(root, function() {
                root.cascade(function(node) {
                    if (node !== root) {
                        log.push(node);
                    }
                });
                t.eq(log.length, 14, "We expect 14 nodes");
                t.eq(log[0].attributes.type, "Text", "Correct type");
                t.eq(log[1].text, "${name}", "Fieldname used in node text");
                t.eq(log[1].attributes.type, "Label", "Correct subType created");
                t.ok(log[2].attributes.type === "Label" && log[2].getUI().isChecked() === false, "Correct subType created, but unchecked");
                t.eq(log[3].attributes.type, "Polygon", "Correct type");
                t.eq(log[4].attributes.symbolizer.fill, false, "For Stroke, fill is false");
                t.eq(log[4].attributes.type, "Stroke", "Correct subType");
                t.ok(log[5].attributes.type === "Stroke" && log[5].getUI().isChecked() === false, "Correct subType created, but unchecked");
                t.eq(log[6].attributes.type, "Fill", "Correct subType");
                t.eq(log[6].attributes.symbolizer.stroke, false, "For Fill, stroke is false");
                t.ok(log[7].attributes.type === "Fill" && log[7].getUI().isChecked() === false, "Correct subType created, but unchecked");
                t.eq(log[8].attributes.type, "Point", "Correct type");
                t.eq(log[9].attributes.type, "Graphic", "Correct subType");
                t.eq(log[10].attributes.type, "Mark", "Correct subType");
                t.ok(log[11].attributes.type === "Mark" && log[11].getUI().isChecked() === false, "Correct subType created, but unchecked");
                t.eq(log[12].attributes.type, "Line", "Correct type");
                t.eq(log[13].attributes.type, "Stroke", "Correct subType");
                t.ok(log[13].getUI().isChecked() === false, "Node is unchecked");
            });
        }

    </script>
  </head>
  <body>
  </body>
</html>
